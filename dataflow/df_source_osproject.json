{
	"name": "df_source_osproject",
	"properties": {
		"folder": {
			"name": "rfm"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "parOSProjects",
						"type": "DatasetReference"
					},
					"name": "SourceOSProjects"
				},
				{
					"dataset": {
						"referenceName": "ts_target_scenario",
						"type": "DatasetReference"
					},
					"name": "SourceScenario"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ds_target_osprojects",
						"type": "DatasetReference"
					},
					"name": "TargetTable"
				}
			],
			"transformations": [
				{
					"name": "Join1"
				},
				{
					"name": "Select1"
				},
				{
					"name": "DerivedColumn1"
				}
			],
			"script": "parameters{\n\tparamLastUpdateDateTime as date,\n\tparamRunId as string\n}\nsource(output(\n\t\tOS_Project_Overview_ID as integer,\n\t\tOS_Scenario_ID as integer,\n\t\tProject_Flag as string,\n\t\tYear_Submitted as integer,\n\t\tProject_Name as string,\n\t\tOSR_Project_Number as string,\n\t\tOperator as string,\n\t\tProject_Area_Region as string,\n\t\tScenario as string,\n\t\tPhase as string,\n\t\tTechnology as string,\n\t\tDensity as decimal(18,12),\n\t\tSulphur as string,\n\t\tTAN as string,\n\t\tNet_Cumulative_Balance as decimal(19,4),\n\t\tCapacity_Bitumen as decimal(16,1),\n\t\tCapacity_Steam as decimal(16,1),\n\t\tProject_Status as string,\n\t\t{Project_Suspended/Cancelled/Deferred} as string,\n\t\tProject_Indefinitely as string,\n\t\tProject_Source as string,\n\t\tDeleted as boolean,\n\t\tDeletedDate as timestamp,\n\t\tAdditionalNotes as string,\n\t\tProjectPayoutDate as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> SourceOSProjects\nsource(output(\n\t\tOSScenarioKey as integer,\n\t\tOSRNumber as string,\n\t\tScenario as string,\n\t\tYearSubmitted as integer,\n\t\tVersion as integer,\n\t\tAsOfDate as timestamp,\n\t\tComments as string,\n\t\tCreatedDate as timestamp,\n\t\tCreatedBy as string,\n\t\tDeleted as boolean,\n\t\tDeletedDate as timestamp,\n\t\tLastUpdateTime as timestamp,\n\t\tRunId as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> SourceScenario\nSourceOSProjects, SourceScenario join(trim(OSR_Project_Number,' ') == trim(OSRNumber, ' ')\n\t&& Year_Submitted == YearSubmitted\n\t&& trim(SourceOSProjects@Scenario, ' ') == trim(SourceScenario@Scenario, ' '),\n\tjoinType:'left',\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tProjectFlag = Project_Flag,\n\t\tYearSubmitted = Year_Submitted,\n\t\tProjectName = Project_Name,\n\t\tOSRNumber = OSR_Project_Number,\n\t\tOperator,\n\t\tProjectAreaRegion = Project_Area_Region,\n\t\tPhase,\n\t\tTechnology,\n\t\tDensity,\n\t\tSulphur,\n\t\tTAN,\n\t\tNetCumulativeBalance = Net_Cumulative_Balance,\n\t\tBitumenCapacity = Capacity_Bitumen,\n\t\tSteamCapacity = Capacity_Steam,\n\t\tProjectStatus = Project_Status,\n\t\t{Project_Suspended/Cancelled/Deferred},\n\t\tProjectIndefinitely = Project_Indefinitely,\n\t\tProjectSource = Project_Source,\n\t\tDeleted = SourceOSProjects@Deleted,\n\t\tDeletedDate = SourceOSProjects@DeletedDate,\n\t\tAdditionalNotes,\n\t\tProjectPayoutDate,\n\t\tOSScenarioKey\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 derive(colLastUpdateDateTime = $paramLastUpdateDateTime,\n\t\tcolRunId = $paramRunId) ~> DerivedColumn1\nDerivedColumn1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tOSProjectKey as integer,\n\t\tOSScenarioKey as integer,\n\t\tProjectFlag as string,\n\t\tYearSubmitted as integer,\n\t\tProjectName as string,\n\t\tOSRNumber as string,\n\t\tOperator as string,\n\t\tProjectAreaRegion as string,\n\t\tPhase as string,\n\t\tTechnology as string,\n\t\tDensity as decimal(18,4),\n\t\tSulphur as string,\n\t\tTAN as string,\n\t\tNetCumulativeBalance as decimal(19,4),\n\t\tBitumenCapacity as decimal(16,1),\n\t\tStreamCapacity as decimal(16,1),\n\t\tProjectStatus as string,\n\t\tProject_SusCancDeffered as string,\n\t\tProjectIndefinitely as string,\n\t\tProjectSource as string,\n\t\tDeleted as boolean,\n\t\tDeletedDate as timestamp,\n\t\tAdditionalNotes as string,\n\t\tProjectPayoutDate as timestamp,\n\t\tLastUpdateTime as timestamp,\n\t\tRunId as string\n\t),\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError',\n\tmapColumn(\n\t\tOSScenarioKey,\n\t\tProjectFlag,\n\t\tYearSubmitted,\n\t\tProjectName,\n\t\tOSRNumber,\n\t\tOperator,\n\t\tProjectAreaRegion,\n\t\tPhase,\n\t\tTechnology,\n\t\tDensity,\n\t\tSulphur,\n\t\tTAN,\n\t\tNetCumulativeBalance,\n\t\tBitumenCapacity,\n\t\tStreamCapacity = SteamCapacity,\n\t\tProjectStatus,\n\t\tProject_SusCancDeffered = {Project_Suspended/Cancelled/Deferred},\n\t\tProjectIndefinitely,\n\t\tProjectSource,\n\t\tDeleted,\n\t\tDeletedDate,\n\t\tAdditionalNotes,\n\t\tProjectPayoutDate,\n\t\tRunId = colRunId\n\t)) ~> TargetTable"
		}
	}
}